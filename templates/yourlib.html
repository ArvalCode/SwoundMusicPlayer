<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Your SWOUND Library</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        header {
            padding: 20px;
            text-align: center;
            font-size: 24px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .audio-container {
            margin-top: 20px;
        }

        audio {
            margin-bottom: 10px;
            width: 100%;
        }
    </style>
</head>

<body>
    <header>Your SWOUND Library</header>
    <div class="container"> <img src="{{ url_for('static', filename='music/' + name + '/' + coverimg) }}"
            alt="Album Cover">
        <div class="audio-container"> 
            {% for audio_file in audiofiles %} 
            <label for="audio{{ loop.index }}">{{audio_file|replace('-', ' ')}}</label>
            <audio onplay = "audclicked('{{loop.index}}')" id="audio{{ loop.index }}" controls>
                <source src="{{ url_for('static', filename='music/' + name + '/audio/' + audio_file) }}"
                    type="audio/mpeg"> Your browser does not support the audio element.
            </audio> <br> 
            {% endfor %} 
        
        </div> <button class="btn" onclick="playAllAudios()"><i
                class="material-icons">play_arrow</i></button> <button class="btn" onclick="shuffle()"><i
                class="material-icons">shuffle</i></button> <button class="btn" onclick="pauseAllAudios()"><i
                class="material-icons">pause</i></button> <button class="btn" onclick="skipBack()"><i
                class="material-icons">skip_previous</i></button> <button class="btn" onclick="skipForward()"><i
                class="material-icons">skip_next</i></button>
    </div>
    <script> 
    var currentAudioInd = 0;

    function playAllAudios() {
        var audioElements=document.querySelectorAll('audio');
        playAudio(audioElements, currentAudioInd);
    }

    function audclicked(ind) {
        pauseAllAudiosExceptcurr(ind-1)
        currentAudioInd = ind-1;
        console.log(currentAudioInd);

    }

    function playAudio(audioElements, index) {
        if (index < audioElements.length) {
            var audio=audioElements[index];
            audio.play();
    
            audio.onended=function () {
                currentAudioInd+=1;
                playAudio(audioElements, index + 1);
            }
    
            ;
        }
    }
    
    function pauseAllAudiosExceptcurr(ind) {
        var audioElements=document.querySelectorAll('audio');
        var i = 0;
        audioElements.forEach(function (audio) {
                if (i != ind) {
                audio.pause();
                }
                i ++;
            });
    }

    function pauseAllAudios() {
        var audioElements=document.querySelectorAll('audio');
    
        audioElements.forEach(function (audio) {
                audio.pause();
            });
    }
    
    function skipBack() {
        var currentAudio=document.querySelectorAll('audio');
        currentAudio[currentAudioInd].currentTime -=10;
    }
    
    function skipForward() {
        var currentAudio=document.querySelectorAll('audio');
        currentAudio[currentAudioInd].currentTime +=10;
    }
    
    function shuffle() {
location.reload();
    }
    
    </script>
</body>

</html>